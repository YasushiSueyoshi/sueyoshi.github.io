<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow" />
  <title>å£ä¸Šã‚»ãƒªãƒ•ã‹ã‚‰ãƒ—â—ã‚­ãƒ¥â—ã‚’å½“ã¦ã‚‹ã‚¯ã‚¤ã‚º</title>
  <style>
  /* PC
  ------------------------------------------------------------------- */
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-color: #fff1f5;
      color: #333;
    }
    .sp_br {
      display: none;
    }
    h2 {
      text-align: center;
    }
    #quiz-container {
      background-color: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 700px;
      padding: 30px;
      text-align: center;
      box-sizing: border-box;
    }
    #question p {
      font-size: 1.1em;
      background-color: #f0f8ff;
      padding: 10px;
      border-left: 5px solid #87cefa;
    }
    #choices button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      font-size: 1em;
      color: #333;
      cursor: pointer;
      border-radius: 8px;
      background-color: #f8f9fa;
      border: 2px solid #dee2e6;
      transition: background-color 0.2s, border-color 0.2s;
    }
    #choices button:hover:not([disabled]) {
        background-color: #e9ecef;
        border-color: #adb5bd;
    }
    #choices button.correct {
      border: 2px solid green;
      background-color: #ddfff6;
    }
    #choices button.incorrect {
      border: 2px solid red;
      background-color: #f7c3c3;
    }
    button.next-question {
      background-color: #fbd6e2;
      border: none;
      padding: 20px 30px;
      width: 250px;
      font-size: 1em;
      font-weight: bold;
      color: #333;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: block;
      margin: 30px auto 0;
    }

    button.next-question:hover {
      background-color: #f8c1d6; /* ãƒ›ãƒãƒ¼æ™‚ã«å°‘ã—æ¿ƒã */
    }
    #result {
      font-size: 3rem;
      font-weight: bold;
      text-align: center;
    }
    .info-block {
      border: 4px solid #ccc;
      border-radius: 8px;
      padding: 15px 20px;
      margin-top: 20px;
      background-color: #fefefe;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .info-block h3 {
      margin-top: 0;
      color: #d63384; /* ãƒ”ãƒ³ã‚¯ç³»ã®è¦‹å‡ºã—è‰² */
      font-size: 1.2em;
      font-weight: bold;
      border-bottom: 1px solid #fbd6e2;
      padding-bottom: 5px;
    }

    .info-block ul {
      list-style: none;
      padding-left: 0;
      margin-top: 10px;
    }

    .info-block li {
      margin-bottom: 6px;
    }

    a.image-search-button {
      display: inline-block;
      background-color: #ffe4ec;
      color: #d63384;
      text-decoration: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 0.95em;
      margin-top: 8px;
      transition: all 0.3s ease;
      border: 1px solid #fbd6e2;
    }

    a.image-search-button:hover {
      background-color: #fbd6e2;
      transform: scale(1.03);
    }

    @keyframes wiggle {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
      75% { transform: rotate(-10deg); }
      100% { transform: rotate(0deg); }
    }

    a.image-search-button:hover::before {
      animation: wiggle 0.4s ease;
      display: inline-block;
    }
    /* ãƒšãƒ¼ã‚¸ã‚ãã‚Š*/
    #page-peel {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 400px; /* Hover area */
        height: 400px; /* Hover area */
        cursor: pointer;
        z-index: 9999;
        backface-visibility: hidden;
    }

    #page-peel::before {
        position: absolute;
        bottom: 0;
        left: 0;
        content: "";
        width: 15px;
        height: 15px;
        background: linear-gradient(225deg, white 50%,gray 53%,white 57%, gray 58%, white 65%);
        box-shadow: 1px -1px 0px 0px;
        transition: width 0.4s, height 0.4s;
    }

    #page-peel:hover::before {
        width: 400px;
        height: 400px;
    }

    #page-peel span {
        position: absolute;
        bottom: 80px;
        left: -30px;
        width: 300px;
        text-align: center;
        font-size: .75em;
        font-weight: bold;
        color: #333;
        transform: rotate(45deg);
        opacity: 0;
        transition: opacity 0.4s 0.1s;
        line-height: 1;
    }

    #page-peel:hover span {
        opacity: 1;
    }
  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–
  ------------------------------------------------------------------- */
  @media screen and (max-width: 600px) {
    body {
      padding: 10px;
    }
    .sp_br {
      display: block;
    }
    h2 {
      font-size: 1.2em;
    }
    #quiz-container {
        padding: 20px;
    }
    #question p {
      font-size: 1em;
      padding: 8px;
    }

    #choices button {
      font-size: 0.95em;
      padding: 10px;
    }

    .next-question {
      width: 100%;
      padding: 16px 20px;
      font-size: 1em;
    }

    .info-block {
      padding: 12px 14px;
    }

    .image-search-button {
      display: block;
      text-align: center;
      margin-top: 10px;
      font-size: 0.95em;
    }
    #page-peel {
      display: none;
    }
  }

#mode-selection {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 30px;
}

#mode-selection h3 {
  grid-column: 1 / -1; /* è¦‹å‡ºã—ã¯2ã‚«ãƒ©ãƒ ã‚’ã¾ãŸãã‚ˆã†ã« */
  text-align: center;
  margin-bottom: 5px;
}

#mode-selection button {
  display: block;
  width: 100%;
  padding: 12px 8px;
  font-size: 0.9em;
  font-weight: bold;
  color: #d63384; /* ãƒ”ãƒ³ã‚¯ç³»ã®æ–‡å­—è‰² */
  background-color: #fff;
  border: 2px solid #fbd6e2; /* ãƒ”ãƒ³ã‚¯ç³»ã®æ ç·š */
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

#mode-selection button:hover {
  background-color: #ffe4ec; /* ãƒ›ãƒãƒ¼æ™‚ã«è–„ã„ãƒ”ãƒ³ã‚¯ã« */
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

#mode-selection .all-series-btn {
  grid-column: 1 / -1; /* ã“ã®ãƒœã‚¿ãƒ³ã ã‘1è¡Œå…¨ä½“ã‚’ä½¿ã† */
}
  </style>
</head>
<body>

<div id="page-peel"><span>ãƒ—ãƒªã‚­ãƒ¥ã‚¢ã«ãƒ‰ã¯ã¾ã‚Šã—ãŸå§ªï¼ˆ3æ­³ï¼‰ãŒ<br>ã¶åšã„ãƒ—ãƒªã‚­ãƒ¥ã‚¢å›³é‘‘ã‹ã‚‰ã‚¯ã‚¤ã‚ºå‡ºã—ã¾ãã‚‹ã®ã§<br>æ€¥é½ãƒ—ãƒªã‚­ãƒ¥ã‚¢ã®å£ä¸Šã¨åå‰ã‚’è¦šãˆã‚‹ã“ã¨ã«ãªã‚Šä½œæˆã€‚<br>NotebookLMã§ãƒ—ãƒªã‚­ãƒ¥ã‚¢æƒ…å ±ã®æ•´ç†JSONä½œæˆ<br>Copilotã§html/css/jsä½œæˆ<br>ä½œæˆç´„6h</span></div>

<h2>å£ä¸Šã‚»ãƒªãƒ•ã‹ã‚‰<br class="sp_br">ãƒ—ãƒªã‚­ãƒ¥ã‚¢ã‚’å½“ã¦ã‚‹ã‚¯ã‚¤ã‚º</h2>
<p style="text-align: center;">ãµãŸã‚Šã¯ãƒ—ãƒªã‚­ãƒ¥ã‚¢ï½ã‚­ãƒŸã¨ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ—ãƒªã‚­ãƒ¥ã‚¢ã‹ã‚‰å‡ºé¡Œ</p>
  <div id="mode-selection">
    <h3>å‡ºé¡Œç¯„å›²ã‚’é¸ã‚“ã§ãã ã•ã„</h3>
  </div>
<a href="#" id="back-to-selection" style="display: none; text-align: center; display: block; margin-bottom: 15px;">ã‚·ãƒªãƒ¼ã‚ºä¸€è¦§ã¸æˆ»ã‚‹</a>
<div id="quiz-container" style="display: none;">
    <div id="question"></div>
    <div id="choices"></div>
    <div id="result" style="margin-top: 20px;"></div>
    <div id="details" style="margin-top: 20px;"></div>
    <div style="margin-top: 30px;">
      <button class="next-question" onclick="renderQuestion()" ontouchend="event.preventDefault(); renderQuestion()">æ¬¡ã®å•é¡Œã¸</button>
    </div>
</div>

    <script>
      let quizData = [];
      let selectedSeriesTitle = 'all';
      let lastCorrectCureName = null;
  
      function renderModeSelection(data) {
        const modeSelectionDiv = document.getElementById('mode-selection');
        modeSelectionDiv.innerHTML = '<h3>å‡ºé¡Œç¯„å›²ã‚’é¸ã‚“ã§ãã ã•ã„</h3>';
  
        const allBtn = document.createElement('button');
        allBtn.textContent = 'ã™ã¹ã¦ã®ã‚·ãƒªãƒ¼ã‚ºã‹ã‚‰å‡ºé¡Œ';
        allBtn.classList.add('all-series-btn'); // CSSç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
        allBtn.onclick = () => startQuiz('all');
        allBtn.ontouchend = (e) => { e.preventDefault(); startQuiz('all'); };
        modeSelectionDiv.appendChild(allBtn);
  
        data.forEach(series => {
          const seriesBtn = document.createElement('button');
          const seriesNumMatch = series.series_number.match(/\d+/);
          const formattedSeriesNum = seriesNumMatch ? seriesNumMatch[0] : series.series_number; // ã€Œã‚·ãƒªãƒ¼ã‚ºã€ã‚’å‰Šé™¤
          seriesBtn.textContent = `${formattedSeriesNum}. ${series.series_title}`;
          seriesBtn.onclick = () => startQuiz(series.series_title);
          seriesBtn.ontouchend = (e) => { e.preventDefault(); startQuiz(series.series_title); };
          modeSelectionDiv.appendChild(seriesBtn);
        });
      }
  
      function startQuiz(seriesTitle) {
        selectedSeriesTitle = seriesTitle;
        document.getElementById('mode-selection').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        document.getElementById('back-to-selection').style.display = 'block';
        renderQuestion();
      }
  
      async function loadQuizData() {
        const response = await fetch("allstars_nanori.json");
        const data = await response.json();
        return data;
      }
  
      function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
      }
  
      function maskCureNameInCatchphrase(catchphrase, cureName) {
        if (!cureName || !catchphrase) return catchphrase || '';
        return catchphrase.replace(new RegExp(cureName, "g"), "ã‚­ãƒ¥ã‚¢â—â—â—");
      }
  
      function getRandomQuestion() {
        let series;
        if (selectedSeriesTitle === 'all') {
          series = quizData[Math.floor(Math.random() * quizData.length)];
        } else {
          series = quizData.find(s => s.series_title === selectedSeriesTitle);
          if (!series) { // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            series = quizData[Math.floor(Math.random() * quizData.length)];
          }
        }
        
        const cures = series.cures;
        let potentialCure;
        
        // å•é¡Œæ•°ãŒ2ã¤ä»¥ä¸Šã‚ã‚Šã€ã‹ã¤å‰å›ã¨åŒã˜å•é¡ŒãŒé¸ã°ã‚ŒãŸå ´åˆã¯å†æŠ½é¸
        do {
          potentialCure = cures[Math.floor(Math.random() * cures.length)];
        } while (cures.length > 1 && potentialCure.cure_name === lastCorrectCureName);
        
        const correctCure = potentialCure;
  
        return {
          catchphrase: correctCure.catchphrase,
          correct: correctCure,
          choices: shuffle(cures.map(c => c.cure_name)),
          series: series
        };
      }
  
      function renderQuestion() {
        const quiz = getRandomQuestion();
        lastCorrectCureName = quiz.correct.cure_name; // å‰å›å‡ºé¡Œã•ã‚ŒãŸå•é¡Œã®ã‚­ãƒ£ãƒ©åã‚’ä¿å­˜
  
        const questionDiv = document.getElementById("question");
        const choicesDiv = document.getElementById("choices");
        const resultDiv = document.getElementById("result");
        const detailsDiv = document.getElementById("details");
  
        resultDiv.innerHTML = "";
        detailsDiv.innerHTML = "";
        choicesDiv.innerHTML = "";
  
        const maskedCatchphrase = maskCureNameInCatchphrase(quiz.catchphrase, quiz.correct.cure_name);
        questionDiv.innerHTML = `<p><strong>å•é¡Œï¼š</strong>${maskedCatchphrase}</p>`;
  
  
        quiz.choices.forEach(name => {
          const btn = document.createElement("button");
          btn.textContent = name;
          const action = () => checkAnswer(name, quiz);
          btn.onclick = action;
          btn.ontouchend = (e) => { e.preventDefault(); action(); };
          choicesDiv.appendChild(btn);
        });
      }
  
      function getMainColorCode(colorString) {
        if (!colorString) return 'inherit';
        const colorMap = {
          "ãƒ”ãƒ³ã‚¯": "hotpink",
          "èµ¤ç´«": "mediumvioletred",
          "èµ¤": "red",
          "é’": "blue",
          "æ°´è‰²": "deepskyblue",
          "ç´«": "purple",
          "é»„": "gold",
          "ã‚ªãƒ¬ãƒ³ã‚¸": "darkorange",
          "ç·‘": "limegreen",
          "é»„ç·‘": "yellowgreen",
          "é»’": "black",
          "ç™½": "#696969", // dimgray
          "ä¹³ç™½": "#696969" // dimgray
        };
  
        for (const key in colorMap) {
          if (colorString.includes(key)) {
            return colorMap[key];
          }
        }
        return 'inherit'; // ãƒãƒƒãƒã—ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      }
  
      function checkAnswer(selected, quiz) {
        const correct = quiz.correct.cure_name;
        const resultDiv = document.getElementById("result");
        const detailsDiv = document.getElementById("details");
        const buttons = document.querySelectorAll("#choices button");
  
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.onclick = null;
          btn.ontouchend = null;
          if (btn.textContent === correct) {
            btn.classList.add("correct");
          } else if (btn.textContent === selected) {
            btn.classList.add("incorrect");
          }
        });
  
        const c = quiz.correct;
        const s = quiz.series;
  
        resultDiv.innerHTML = selected === correct
          ? `<span style='color:red;'>â—‹ã›ã„ã‹ã„ï¼</span>`
          : `<span style='color:blue;'>Ã—ã–ã‚“ã­ã‚“â€¦</span>`;
  
        const colorName = c.main_color;
        const colorCode = getMainColorCode(colorName);
  
        let op = 'æƒ…å ±ãªã—';
        let ed = 'æƒ…å ±ãªã—';
  
        if (s.theme_songs) {
          if (s.theme_songs.opening) {
            // é€šå¸¸ã®æ§‹é€ 
            op = s.theme_songs.opening;
            ed = s.theme_songs.ending;
          } else if (s.theme_songs[s.series_title]) {
            // ã‚¿ã‚¤ãƒˆãƒ«ãŒã‚­ãƒ¼ã«ãªã£ã¦ã„ã‚‹æ§‹é€ 
            const theme = s.theme_songs[s.series_title];
            op = theme.opening;
            ed = theme.ending;
          }
        }
  
        detailsDiv.innerHTML = `
          <div class="info-block">
            <h3>æ­£è§£ã‚­ãƒ£ãƒ©æƒ…å ±</h3>
            <ul>
              <li><strong>åå‰ï¼š</strong>${c.cure_name}</li>
              <li><strong>å¤‰èº«å‰ï¼š</strong>${c.civilian_name}</li>
              <li><strong>å£°å„ªï¼š</strong>${c.voice_actor}</li>
              <li><strong>å­¦å¹´ï¼š</strong>${c.grade_age}</li>
              <li><strong>ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ï¼š</strong><span style="color: ${colorCode}; font-weight: bold;">${colorName || ''}</span></li>
              <li><strong>åä¹—ã‚Šï¼š</strong>${c.catchphrase}</li>
              <li><a href="${c.cure_image}" target="_blank" class="image-search-button">ğŸ” ${c.cure_name}ã®ç”»åƒã‚’æ¤œç´¢ã™ã‚‹
    </a>
  </li>
            </ul>
          </div>
  
          <div class="info-block">
            <h3>ã‚·ãƒªãƒ¼ã‚ºæƒ…å ±</h3>
            <ul>
              <li><strong>ã‚·ãƒªãƒ¼ã‚ºï¼š</strong>${s.series_number}</li>
              <li><strong>ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong>${s.series_title}</li>
              <li><a href="${s.series_title_search_image}" target="_blank" class="image-search-button">ğŸ” ã€Œ${s.series_title}ã€ã®ç”»åƒã‚’æ¤œç´¢ã™ã‚‹</a></li>
              <li><strong>æ”¾é€æœŸé–“ï¼š</strong>${s.broadcast_period}</li>
              <li><strong>ä¸»é¡Œæ­Œï¼š</strong><br>
                OPï¼š${op || 'æƒ…å ±ãªã—'}<br>
                EDï¼š${ed || 'æƒ…å ±ãªã—'}
              </li>
            </ul>
          </div>
        `;
      }
  
      loadQuizData().then(data => {
        quizData = data;
        renderModeSelection(data);

        document.getElementById('back-to-selection').addEventListener('click', (e) => {
          e.preventDefault();
          document.getElementById('quiz-container').style.display = 'none';
          document.getElementById('back-to-selection').style.display = 'none';
          document.getElementById('mode-selection').style.display = 'grid';
          document.getElementById("question").innerHTML = "";
          document.getElementById("choices").innerHTML = "";
          document.getElementById("result").innerHTML = "";
          document.getElementById("details").innerHTML = "";
        });
      });
    </script></body>
</html>
